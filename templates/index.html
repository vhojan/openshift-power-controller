<!DOCTYPE html>
<html>
<head>
    <title>OpenShift Power Controller</title>
    <style>
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        canvas { width: 160px !important; height: 60px !important; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>OpenShift Power Controller</h1>
    <table>
        <thead>
            <tr>
                <th>Node</th>
                <th>CPU Usage</th>
                <th>Memory Usage</th>
                <th>Power</th>
                <th>Graph</th>
            </tr>
        </thead>
        <tbody>
            {% for node in data %}
            <tr>
                <td>{{ node.name }}</td>
                <td>{{ node.cpu or "?" }} cores</td>
                <td>{{ (node.mem / 1073741824) | round(2) if node.mem else "?" }} GiB</td>
                <td>
                    <button onclick="sendPower('{{ node.name }}', 'off')">Off</button>
                    <button onclick="sendPower('{{ node.name }}', 'on')">On</button>
                    <button onclick="sendPower('{{ node.name }}', 'reset')">Reset</button>
                </td>
                <td>
                    <canvas id="chart-{{ loop.index }}"></canvas>
                    <script>
                        const ctx{{ loop.index }} = document.getElementById('chart-{{ loop.index }}').getContext('2d');
                        new Chart(ctx{{ loop.index }}, {
                            type: 'line',
                            data: {
                                labels: ['Used', 'Total'],
                                datasets: [
                                    {
                                        label: 'CPU',
                                        data: [{{ node.cpu or 0 }}, {{ node.cpu_total }}],
                                        borderColor: 'orange',
                                        fill: true
                                    },
                                    {
                                        label: 'Memory',
                                        data: [{{ (node.mem / 1073741824) | round(2) if node.mem else 0 }}, {{ (node.mem_total / 1073741824) | round(2) }}],
                                        borderColor: 'blue',
                                        fill: true
                                    }
                                ]
                            },
                            options: {
                                responsive: false,
                                plugins: { legend: { display: false } },
                                scales: {
                                    x: { display: false },
                                    y: { display: false }
                                }
                            }
                        });
                    </script>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</body>
<script>
function sendPower(node, action) {
    fetch(`/power/${node}/${action}`, { method: "POST" }).then(r => r.json()).then(console.log);
}
</script>
</html>
