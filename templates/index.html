<table>
  <thead>
    <tr>
      <th>Node</th>
      <th>CPU Usage</th>
      <th>Memory Usage</th>
      <th>Power</th>
      <th>Graph</th>
    </tr>
  </thead>
  <tbody>
    {% for node, info in data.items() %}
    <tr>
      <td>{{ node }}</td>
      <td>{{ info.cpu_used }} cores</td>
      <td>{{ info.memory_used }} GiB</td>
      <td>
        <button onclick="sendPower('{{ node }}', 'off')">Off</button>
        <button onclick="sendPower('{{ node }}', 'on')">On</button>
        <button onclick="sendPower('{{ node }}', 'reset')">Reset</button>
      </td>
      <td>
        <canvas id="chart-{{ node }}" width="200" height="60"></canvas>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<script>
const nodeData = {{ data|tojson }};
Object.keys(nodeData).forEach(node => {
  const ctx = document.getElementById(`chart-${node}`);
  const cpu = parseFloat(nodeData[node].cpu_used);
  const cpuMax = parseFloat(nodeData[node].cpu_total);
  const mem = parseFloat(nodeData[node].memory_used);
  const memMax = parseFloat(nodeData[node].memory_total);

  new Chart(ctx, {
    type: 'line',
    data: {
      labels: ['Used', 'Total'],
      datasets: [
        {
          label: 'CPU',
          data: [cpu, cpuMax],
          borderColor: '#FFA500',
          backgroundColor: 'rgba(255,165,0,0.1)',
          fill: true,
          tension: 0.3,
        },
        {
          label: 'Memory',
          data: [mem, memMax],
          borderColor: '#1E90FF',
          backgroundColor: 'rgba(30,144,255,0.1)',
          fill: true,
          tension: 0.3,
        }
      ]
    },
    options: {
      responsive: false,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false
        },
      },
      scales: {
        y: {
          display: false
        },
        x: {
          display: false
        }
      }
    }
  });
});
</script>
